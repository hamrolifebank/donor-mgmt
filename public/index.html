<!doctype html>
<html lang="en">

<head>
  <title>Scanned Doc - Immunity Passport</title>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <link rel="shortcut icon" href="https://assets.rumsan.com/esatya/esatya-favicon.png	" />
  <link rel="stylesheet" type="text/css"
    href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:400,700|Material+Icons" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css">
  <link href="resources/css/material-kit.css?v=2.0.7" rel="stylesheet" />
  <link href="resources/css/custom.css" rel="stylesheet" />
  <link href="resources/css/mobile.css" rel="stylesheet" />
</head>

<body>
  <div class="container">
    <div class="section p-0">
      <div class="row mb-5 mt-3">
        <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12 text-center mb-4">
          <img src="https://assets.rumsan.com/esatya/esatya-black.png" class="img-fluid welcome_image"
            alt="Responsive image">
        </div>
      </div>
    </div>
  </div>
  <div class="main main-raised">
    <div class="container">
      <div class="section">
        <div class="row mb-2">
          <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
          </div>
        </div>
        <div class="row">
          <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
            <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
              <div class="carousel-inner">
                <div class="carousel-item active">
                  <img id="profile" class="d-block" src=""
                    onerror="this.onerror=null;this.src='https://assets.rumsan.com/esatya/no-profile-available.jpg';"
                    alt="Profile Pic" style="margin: auto; height: 300px;max-width: 100%">
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="row text-center" style="margin-top:2rem;">
          <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
            <span id="status"></span>
            <hr />
          </div>
        </div>
        <div class="row text-center" style="margin-top:1rem;">
          <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
            <p class="goat-info">Patient Details</p>
            <hr />
          </div>
        </div>
        <div class="row mt-2">
          <div class="col-xl-3 col-lg-3 col-md-6 col-sm-6 col-12 mt-2">
            <div class="shadow-sm p-3 mb-5 bg-white rounded text-center">
              <h1 id="name" class="batch-property">
                N/A
              </h1>
              <p class="batch-property-value">Patient Name</p>
            </div>
          </div>
          <div class="col-xl-3 col-lg-3 col-md-6 col-sm-6 col-12 mt-2">
            <div class="shadow-sm p-3 mb-5 bg-white rounded text-center">
              <h1 id="phone" class="batch-property">
                N/A
              </h1>
              <p class="batch-property-value">Contact Number</p>
            </div>
          </div>
          <div class="col-xl-3 col-lg-3 col-md-6 col-sm-6 col-12 mt-2">
            <div class="shadow-sm p-3 mb-5 bg-white rounded text-center">
              <h1 id="address" class="batch-property">
                N/A
              </h1>
              <p class="batch-property-value">Address</p>
            </div>
          </div>
          <div class="col-xl-3 col-lg-3 col-md-6 col-sm-6 col-12 mt-2">
            <div class="shadow-sm p-3 mb-5 bg-white rounded text-center">
              <h1 id="email" class="batch-property">
                N/A
              </h1>
              <p class="batch-property-value">Email</p>
            </div>
          </div>
          <div class="col-xl-3 col-lg-3 col-md-6 col-sm-6 col-6 mt-2">
            <div class="shadow-sm p-3 mb-5 bg-white rounded text-center">
              <h1 id='gender' class="batch-property">
                N/A
              </h1>
              <p class="batch-property-value">Gender</p>
            </div>
          </div>
          <div class="col-xl-3 col-lg-3 col-md-6 col-sm-6 col-6 mt-2">
            <div class="shadow-sm p-3 mb-5 bg-white rounded text-center">
              <h1 id='dob' class="batch-property">
                N/A
              </h1>
              <p class="batch-property-value">Date of Birth
              </p>
            </div>
          </div>
          <div class="col-xl-3 col-lg-3 col-md-6 col-sm-6 col-6 mt-2">
            <div class="shadow-sm p-3 mb-5 bg-white rounded text-center">
              <h1 id=govt_id_type class="batch-property">
                N/A
              </h1>
              <p class="batch-property-value">Goverment Id</p>
            </div>
          </div>
          <div class="col-xl-3 col-lg-3 col-md-6 col-sm-6 col-6 mt-2">
            <div class="shadow-sm p-3 mb-5 bg-white rounded text-center">
              <h1 id=govt_id class="batch-property">
                N/A
              </h1>
              <p class="batch-property-value">Gov Id No</p>
            </div>
          </div>
          <div class="col-xl-3 col-lg-3 col-md-6 col-sm-6 col-12 mt-2">
            <div class=" bg-white rounded text-center">
              <a id="document" class="btn btn-primary" target="_blank">Check Document</a>
            </div>
          </div>
        </div>
        <div class="row text-center" style="margin-top:1.5rem;">
          <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
            <p class="goat-info">Vaccination Details</p>
            <hr />
          </div>
        </div>
        <div id="vaccineCards" class="row mt-2">
        </div>
      </div>
    </div>
  </div>
  <div class="container">
    <div class="row">
      <div class="col-md-12 text-center p-3">
        <p>Powered by <a href="https://esatya.io" target="_blank" style="color:#3e5569">eSatya.</a></p>
      </div>
    </div>
  </div>
  <script src="resources/js/jquery.min.js" type="text/javascript"></script>
  <script src="resources/js/popper.min.js" type="text/javascript"></script>
  <script src="resources/js/bootstrap-material-design.min.js" type="text/javascript"></script>
  <script>
    let url = window.location.href;
    let patientId = url.split('/')[5];
    async function setPatientData() {
      const data = await fetch(`https://immunity.esatya.io/api/v1/patients/${patientId}`);
      const patientData = await data.json();
      const dob = patientData.dob.split(' ');
      const trimmed_id = patientData.govt_id.type.replace("_", " ").replace(/\w\S*/g, function (txt) { return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase(); });
      const gender = patientData.gender.replace(/\w\S*/g, function (txt) { return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase(); });
      $('#name').text(patientData.name);
      $('#phone').text(patientData.phone);
      $('#address').text(patientData.address);
      $('#email').text(patientData.email);
      $('#gender').text(gender);
      $('#govt_id_type').text(trimmed_id);
      $('#govt_id').text(patientData.govt_id.id);
      $('#dob').text(`${dob[1]}-${dob[2]}-${dob[3]}`);
      $("#profile").attr("src", patientData.picture);
      $("#document").attr("href", `http://172.110.7.136:8080/ipfs/${patientData.ipfs_hash}`);
    }

    async function setVaccineDetails() {
      let data = await fetch(`https://immunity.esatya.io/api/v1/patients/${patientId}/vaccinations/details`);
      let { vaccineCardDetail } = await data.json();
      if (vaccineCardDetail.length >= 2) {
        $("#status").append(`<span class="btn btn-success" style="font-size: 1em;">FULLY IMMUNIZED</span>`);
      } else {
        $("#status").append(`<span class="btn btn-danger" style="font-size: 1em;">NOT IMMUNIZED</span>`);
      }
      vaccineCardDetail.map((curr) => {
        $("#vaccineCards").append(
          `
          <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12 mt-12">
            <div class="shadow-sm p-3 mb-5 bg-white text-center rounded">
              <div class="row text-center">
                <div class="col-6">
                   <span class="batch-property-value" style="float:right">ID</span>
                </div>
                <div class="col-6">
                   <span id="vaccineId" class="batch-property" style="float:left">
                      ${curr.vaccineIdentifier}
                   </span>
                </div>
              </div>
              <div class="row">
                <div class="col-6">
                   <span class="batch-property-value" style="float:right">Type</span>
                </div>
                <div class="col-6">
                   <span id="vaccineType" class="batch-property" style="float:left">
                      ${curr.vaccineType}
                   </span>
                </div>
              </div>
              <div class="row">
                <div class="col-6">
                   <span class="batch-property-value" style="float:right">Date</span>
                </div>
                <div class="col-6">
                   <span id="vaccineDate" class="batch-property" style="float:left">
                      ${curr.vaccinationDate}
                   </span>
                </div>
              </div>
              <div class="row">
                <div class="col-6">
                   <span class="batch-property-value" style="float:right">Batch No.</span>
                </div>
                <div class="col-6">
                   <span id="VaccinationBatch" class="batch-property" style="float:left">
                      ${curr.VaccinationBatch}
                   </span>
                </div>
              </div>
              <div class="row">
                <div class="col-6">
                   <span class="batch-property-value" style="float:right">Center</span>
                </div>
                <div class="col-6">
                   <span id="vaccinationCenterName" class="batch-property" style="float:left">
                      ${curr.vaccinationCenterName}
                   </span>
                </div>
              </div>
              <div class="row">
                <div class="col-6">
                   <span class="batch-property-value" style="float:right">Location</span>
                </div>
                <div class="col-6">
                   <span id="vaccinationCenterLocation" class="batch-property" style="float:left">
                      ${curr.vaccinationCenterLocation}
                   </span>
                </div>
              </div>
              <div class="row">
                <div class="col-12 text-center">
                   <a href=${curr.transaction} target="_blank" class="btn btn-sm btn-primary">Verify</a>
                </div>
              </div>
            </div>
          </div>
          `
        )
      })
    }
    setPatientData();
    setVaccineDetails();
  </script>
</body>

</html>